# Render Blueprint - Infrastructure as Code for SRE Copilot
# Deploy all backend services on Render's free tier
# Docs: https://render.com/docs/blueprint-spec

services:
  # ==========================================================================
  # API Gateway - Public-facing entry point
  # ==========================================================================
  - type: web
    name: sre-copilot-gateway
    runtime: python
    plan: free
    rootDir: services/api-gateway
    buildCommand: chmod +x build.sh && ./build.sh
    startCommand: uvicorn app.main:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /health
    envVars:
      - key: ENVIRONMENT
        value: production
      - key: PYTHON_VERSION
        value: "3.11.0"
      - key: DATABASE_URL
        sync: false
      - key: REDIS_URL
        sync: false
      - key: JWT_SECRET_KEY
        sync: false
      - key: INTERNAL_SERVICE_KEY
        sync: false
      - key: FRONTEND_URL
        value: https://sre-copilot.pages.dev
      - key: AUTH_SERVICE_URL
        value: https://sre-copilot-auth.onrender.com
      - key: INCIDENT_SERVICE_URL
        value: https://sre-copilot-incident.onrender.com
      - key: AI_SERVICE_URL
        value: https://sre-copilot-ai.onrender.com
      - key: INTEGRATION_SERVICE_URL
        value: https://sre-copilot-integration.onrender.com

  # ==========================================================================
  # Auth Service
  # ==========================================================================
  - type: web
    name: sre-copilot-auth
    runtime: python
    plan: free
    rootDir: services/auth-service
    buildCommand: chmod +x build.sh && ./build.sh
    startCommand: uvicorn app.main:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /health
    envVars:
      - key: ENVIRONMENT
        value: production
      - key: PYTHON_VERSION
        value: "3.11.0"
      - key: DATABASE_URL
        sync: false
      - key: REDIS_URL
        sync: false
      - key: JWT_SECRET_KEY
        sync: false
      - key: INTERNAL_SERVICE_KEY
        sync: false
      - key: MONITORING_ENCRYPTION_KEY
        sync: false

  # ==========================================================================
  # Incident Service
  # ==========================================================================
  - type: web
    name: sre-copilot-incident
    runtime: python
    plan: free
    rootDir: services/incident-service
    buildCommand: chmod +x build.sh && ./build.sh
    startCommand: uvicorn app.main:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /health
    envVars:
      - key: ENVIRONMENT
        value: production
      - key: PYTHON_VERSION
        value: "3.11.0"
      - key: DATABASE_URL
        sync: false
      - key: REDIS_URL
        sync: false
      - key: INTERNAL_SERVICE_KEY
        sync: false
      - key: AI_SERVICE_URL
        value: https://sre-copilot-ai.onrender.com

  # ==========================================================================
  # AI Service
  # ==========================================================================
  - type: web
    name: sre-copilot-ai
    runtime: python
    plan: free
    rootDir: services/ai-service
    buildCommand: chmod +x build.sh && ./build.sh
    startCommand: uvicorn app.main:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /health
    envVars:
      - key: ENVIRONMENT
        value: production
      - key: PYTHON_VERSION
        value: "3.11.0"
      - key: DATABASE_URL
        sync: false
      - key: REDIS_URL
        sync: false
      - key: INTERNAL_SERVICE_KEY
        sync: false
      - key: AZURE_OPENAI_ENDPOINT
        sync: false
      - key: AZURE_OPENAI_API_KEY
        sync: false
      - key: AZURE_OPENAI_DEPLOYMENT
        sync: false
      - key: AZURE_OPENAI_MODEL
        sync: false
      - key: AZURE_OPENAI_API_VERSION
        value: "2025-01-01-preview"

  # ==========================================================================
  # Integration Service
  # ==========================================================================
  - type: web
    name: sre-copilot-integration
    runtime: python
    plan: free
    rootDir: services/integration-service
    buildCommand: chmod +x build.sh && ./build.sh
    startCommand: uvicorn app.main:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /health
    envVars:
      - key: ENVIRONMENT
        value: production
      - key: PYTHON_VERSION
        value: "3.11.0"
      - key: DATABASE_URL
        sync: false
      - key: REDIS_URL
        sync: false
      - key: INTERNAL_SERVICE_KEY
        sync: false
      - key: MONITORING_ENCRYPTION_KEY
        sync: false
      - key: INCIDENT_SERVICE_URL
        value: https://sre-copilot-incident.onrender.com

  # ==========================================================================
  # WebSocket Service
  # ==========================================================================
  - type: web
    name: sre-copilot-websocket
    runtime: python
    plan: free
    rootDir: services/websocket-service
    buildCommand: chmod +x build.sh && ./build.sh
    startCommand: uvicorn app.main:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /health
    envVars:
      - key: ENVIRONMENT
        value: production
      - key: PYTHON_VERSION
        value: "3.11.0"
      - key: REDIS_URL
        sync: false
      - key: JWT_SECRET_KEY
        sync: false
      - key: INTERNAL_SERVICE_KEY
        sync: false

  # ==========================================================================
  # Audit Service
  # ==========================================================================
  - type: web
    name: sre-copilot-audit
    runtime: python
    plan: free
    rootDir: services/audit-service
    buildCommand: chmod +x build.sh && ./build.sh
    startCommand: uvicorn app.main:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /health
    envVars:
      - key: ENVIRONMENT
        value: production
      - key: PYTHON_VERSION
        value: "3.11.0"
      - key: DATABASE_URL
        sync: false
      - key: REDIS_URL
        sync: false
      - key: INTERNAL_SERVICE_KEY
        sync: false
